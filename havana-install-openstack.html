---
layout: pages
title: Getting Started (Havana)
tag: Havana
slug: havana-install-openstack
lead: "Find out just how easy it is to get off the ground"
baseurl: "../"
---

<h1 id="installation">Installation</h1>

  <p>The instructions below will guide you through the process of installing Chef, followed by the steps for bootstrapping and configuring your nodes to achieve a functional private cloud installation.</p>

  <blockquote>
    <p>We strongly recommend that you review <a href="../openstack-requirements">OpenStack Requirements</a> before starting. This is to ensure that your environment is ready for install before getting in too deep.</p>
  </blockquote>

  <h2 id="install-chef">Install Chef</h2>

  <p><b>You must install Chef Server first, and the Chef Server should be accessible by what will become your OpenStack nodes on ports 443 and 80.</b></p>

  <p>The Chef server acts as a hub for configuration data. It stores cookbooks, policies applied to each node, and metadata that describes each registered Chef node being managed by the chef-client command. Nodes use the <code>chef-client</code> command to ask the server for configuration details, such as recipes, templates, and file distributions. The <code>chef-client</code> command then performs much of the configuration work on the nodes themselves without much interaction with the server. This scalable approach provides consistent configuration management and quick deployments.</p>

  <p>To install Chef Server, perform the following:</p>

  <ol>
    <li>Go to <a href="http://www.opscode.com/chef/install">http://www.opscode.com/chef/install</a>.</li>
    <li>Click the Chef Server tab.</li>
    <li>Select the operating system, version, and architecture that match the server from which you will run Chef Server.</li>
    <li>Select the version of Chef Server to download, and then click the link that appears to download the package.</li>
    <li>Install the downloaded package using the correct method for the operating system on which Chef Server will be installed. For instance, on Ubuntu and Debian, using <code>sudo dpkg -i package.deb</code> will perform the installation.</li>
    <li>Configure Chef Server by running the command below. This command will set up all required components, including Erchef, RabbitMQ, PostgreSQL, and the cookbooks that are needed by <code>chef-solo</code> to maintain Chef Server.</li>

<pre><code>$ sudo chef-server-ctl reconfigure</code></pre>

  <blockquote>
    <p>Add gliffy image here</p>
  </blockquote>

    <li>Verify the hostname for the server by running the <code>hostname</code> command. The hostname for the server must be a fully qualified domain name (<span class="caps">FQDN</span>). We recommend as well that the proper <code>A</code> records for each of your nodes&#8217; <span class="caps">FQDN</span>s exist in <span class="caps">DNS</span> for easier accessibility.</li>
    <li>When you&#8217;re finished, verify the installation of Chef Server by running the following command:</li>

<pre><code>$ sudo chef-server-ctl test</code></pre>
</ol>

  <p>This will run the <code>chef-pedant</code> test suite against the installed Chef Server and will report that everything is installed correctly and running smoothly.</p>

  <h2 id="install-openstack">Install OpenStack</h2>

  <p>The instructions below provide a general overview of steps you will perform to install an OpenStack environment with private cloud. It demonstrates a typical OpenStack installation, and includes additional information about customizing or modifying your installation. Generally, your installation will follow these steps, with more details outlined in the other sections below.</p>

  <ol>
    <li>Configure a bootstrap script with the hardware servers and/or cloud compute instances (<span class="caps">CCI</span>s) that you wish to bootstrap with Chef; this can be done in a simple shell script. Ensure you substitute the proper <span class="caps">FQDN</span>, the remote user name that has password-less <code>sudo</code> access, the local path to that user&#8217;s private <span class="caps">SSH</span> key, and name of the Chef environment in which the node resides. In this example, we represent these with <span class="caps">FQDN</span>, <span class="caps">USER</span>, and <span class="caps">ENVIRONMENT</span>, respectively.</li>

<pre><code>knife bootstrap FQDN -x USER --sudo -i ~/.ssh/id_rsa -E ENVIRONMENT
</code></pre>

    <li>Edit the role information for each server and role.</li>

<pre><code>knife node run_list add FQDN &#39;role[grizzly-controller]&#39;
</code></pre>

    <li>Run the bootstrap script you&#8217;ve just created to prepare each server before running <code>chef-client</code>.</li>
    <li>Modify the required attributes through Chef environment overrides.</li>
    <li>Run the `chef-client` program on each server to start installation and configuration. Be sure to run the installs in this order:</li>
      <ul>
        <li>MySQL roles</li>
        <li>RabbitMQ roles</li>
        <li>Keystone role</li>
        <li>Controller role</li>
        <li>All remaining roles</li>
      </ul>
  </ol>

  <h2 id="prepare-chef">Prepare Chef for OpenStack Deployment</h2>

  <p>Before OpenStack can be installed to any servers, the private cloud repository needs to be downloaded locally and then uploaded to your Chef Server. To do this, prepare a default Chef directory structure with this command:</p>

<pre><code>$ git clone git://github.com/opscode/chef-repo.git
</code></pre>

  <p>Change directory into <code>~/chef-repo/cookbooks</code> and then download the private cloud repository:</p>

<pre><code>$ cd chef-repo/cookbooks
$ git clone https://github.com/softlayer/TODO:PUBLIC_REPO_NAME</code></pre>

  <p>The private cloud repository also depends on several Opscode cookbooks. Download them into the <code>~/chef-repo/cookbooks</code> directory:</p>

<pre><code>$ git clone https://github.com/opscode-cookbooks/mysql
$ git clone https://github.com/opscode-cookbooks/partial_search
$ git clone https://github.com/opscode-cookbooks/ntp
$ git clone https://github.com/opscode-cookbooks/build-essential
$ git clone https://github.com/opscode-cookbooks/openssl</code></pre>

  <p>The needed OpenStack roles are packaged within the private cloud repository. Copy the roles from the <code>grizzly/</code> directory to the <code>~/chef-repo/roles</code> directory.</p>

<pre><code>$ cp -r ~/chef-repo/cookbooks/TODO:PUBLIC_REPO_NAME/roles ~/chef-repo/roles</code></pre>

  <p>Finally, upload the cookbooks and roles to your Chef server for deployment to remote nodes:</p>

<pre><code>$ knife cookbook upload --all
$ knife role from file ~/chef-repo/roles/*</code></pre>

  <p>If you get any errors during the upload, check that your <code>cookbook_path</code> and <code>role_path</code> are set correctly in the <code>~/.chef/knife.rb</code>. You can optionally re-run the <code>knife</code> configuration client.</p>

  <h2 id="bootstrap-nodes">Bootstrap Your Nodes</h2>

  <p>Bootstrapping is a Chef term for remotely deploying the chef client to a server. It creates the node and client objects in the Chef Server and also adds client keys to both the server and client, allowing to chef-client communicate with the Chef Server.</p>

  <p>Two choices are available for bootstrapping nodes. SoftLayer has provided example scripts, which can be edited for your needs, or you can bootstrap them on your own by following a <code>chef-client</code> install guide or installing <code>chef-client</code> on your own. It is recommended to use the bootstrap scripts.</p>

  <p>Edit the script for each hardware node you would like to include in the OpenStack installation. It is highly recommended that at least three nodes be usedâ€”-one for a controller node, one for a network node, and one for a compute node. After the bootstrap process completes, the script will assign an OpenStack role to the hardware nodes. A node can have more than one role. A three-node bootstrap example script is shown below.</p>

<output><pre>#!/bin/bash

## Bootstrap three nodes with chef-client, registering them with Chef Server
knife bootstrap control1.example.com -x USER --sudo -i ~/.ssh/id_rsa -E ENVIRONMENT
knife bootstrap compute2.example.com -x USER --sudo -i ~/.ssh/id_rsa -E ENVIRONMENT
knife bootstrap network3.example.com -x USER --sudo -i ~/.ssh/id_rsa -E ENVIRONMENT

## Now, add specific roles to each node&#39;s run list that will run once <code>chef-client</code> is run
## Controller node:
knife node run_list add control1.example.com &#39;role[grizzly-mysql-all]&#39;
knife node run_list add control1.example.com &#39;role[grizzly-rabbitmq]&#39;
knife node run_list add control1.example.com &#39;role[grizzly-cinder]&#39;
knife node run_list add control1.example.com &#39;role[grizzly-keystone]&#39;
knife node run_list add control1.example.com &#39;role[grizzly-glance]&#39;
knife node run_list add control1.example.com &#39;role[grizzly-controller]&#39;

## Compute node:
knife node run_list add compute2.example.com &#39;role[grizzly-compute]&#39;

## Network node:
knife node run_list add network3.example.com &#39;role[grizzly-network]&#39;</pre></output>

  <h2 id="configure-chef">Configure Chef Overrides for OpenStack</h2>

  <p>You will need to override some attributes for your OpenStack Chef deployment. These can be overridden at the environment level or at the node level, but the environment level is <b>strongly</b> recommended.</p>

  <p>First, create an environment. It will be used to house your nodes and configuration attributes. The attribute overrides will modify the OpenStack for your deployment without the need to edit the recipes directly.</p>

<pre><code>$ knife environment create NAME -d &quot;Description for environment&quot;</code></pre>

  <p>Edit your environment with the following command (you may also edit this from the Chef web-based UI). An editor will open where you may define your environment&#8217;s attributes in <span class="caps">JSON</span> format.</p>

<pre><code>$ knife environment edit ENVIRONMENT</code></pre>

  <p>Take special care to ensure your final environment document is valid <span class="caps">JSON</span>, as <code>knife</code> may discard your attempted change if the <span class="caps">JSON</span> does not properly validate once you save and exit the editor.</p>

  <p>The following is an example of the recommended minimum attributes that can be overridden in the environment, illustrating the required attributes to deploy:</p>

  <output><pre>"override_attributes": {
    "admin": {
      "password": "admin_pass"
    },
    "network": {
      "public_interface": "eth1",
      "private_interface": "eth0"
    },
    "quantum": {
      "db": {
        "password": "my_new_quantum_pass"
      },
      "softlayer_public_portable": "XX.XX.XX.XX/YY",
      "softlayer_private_portable": "AA.AA.AA.AA/BB"
    },
    "nova": {
      "db": {
        "password": "my_new_nova_pass"
      }
    },
    "glance": {
      "db": {
        "password": "my_new_glance_pass"
      }
    },
    "keystone": {
      "db": {
        "password": "my_new_keystone_pass"
      }
    },
    "cinder": {
      "db": {
        "password": "my_new_cinder_pass"
      }
    }
  }
}</pre></output>

  <h2 id="chef-nodes">Chef Your Nodes</h2>

  <p>The process below outlines how to sequentially <em>chef</em> the nodes. The order in which services come online is important. All OpenStack components depend on MySQL and RabbitMQ, therefore those roles must be completed before attempting to deploy OpenStack-specific components.</p>

  <h3>MySQL and RabbitMQ Nodes</h3>

  <p>If you have chosen to make the MySQL node separate from the controller, you must first complete a deployment of the MySQL role <b>prior</b> to chefing another node with any OpenStack services. You may easily deploy MySQL roles for each OpenStack component by adding your additional nodes to the sample script above and specifying which MySQL role(s) to apply to each. This is discussed in the Scaling &amp; Branching Deployments section.</p>

  <p>Similarly, if you intend to deploy RabbitMQ on a separate server, you may follow the same process, but deploying the RabbitMQ role must be performed prior to chefing the controller with any OpenStack services. It is independent of the MySQL roles.</p>

  <p>Otherwise, please skip to the next step if MySQL and RabbitMQ will run from your controller node.</p>

  <h3>Controller Node</h3>

  <p>The controller node contains, at a minimum, the roles for the base Quantum and Nova services. If you are unfamiliar with OpenStack, it is recommended to do a standard installation as illustrated in the bootstrap example. Be sure that Chef shows that the node contains the MySQL backend, RabbitMQ, Keystone, Cinder, and Glance roles. You can verify this with a simple <code>knife</code> command:</p>

<pre><code>knife node show FQDN</code></pre>

  <p>The output should look similar to this:</p>

<output><pre>Node Name: control1.example.com
Environment: Region
FQDN: control1.example.com
IP: XX.XX.XX.XX
Run List: role[grizzly-mysql-cinder], role[grizzly-mysql-glance], role[grizzly-mysql-keystone], role[grizzly-mysql-nova], role[grizzly-mysql-quantum], role[grizzly-rabbitmq], role[grizzly-keystone], role[grizzly-controller], role[grizzly-cinder], role[grizzly-glance]
Roles: grizzly-mysql-cinder, grizzly-mysql-glance, grizzly-mysql-keystone, grizzly-mysql-nova, grizzly-mysql-quantum, grizzly-rabbitmq, grizzly-keystone, grizzly-controller, grizzly-cinder, grizzly-glance
Recipes: grizzly::set_attributes, grizzly::set_cloudnetwork, ntp, grizzly::mysql-cinder, grizzly::mysql-glance, grizzly::mysql-keystone, grizzly::mysql-nova, grizzly::mysql-quantum, grizzly::ip_forwarding, grizzly::repositories, grizzly::rabbitmq-server, grizzly::keystone, grizzly::quantum-controller, grizzly::nova, grizzly::dashboard, grizzly::cinder, grizzly::glance, grizzly::quantum-network
Platform: ubuntu 12.04
Tags:</pre></output>

  <p>To chef the controller node you can either connect directly to the remote server and (with root privileges) run <code>chef-client</code> from the node itself or use <a href="http://docs.opscode.com/knife_ssh.html">knife ssh</a> to run it from the Chef server:</p>

<pre><code>knife ssh SEARCH_TERM &#39;sudo chef-client&#39;</code></pre>

  <p>For example:</p>

<pre><code>knife ssh &#39;role:grizzly-controller&#39; &#39;sudo chef-client&#39;</code></pre>

  <p>&#8230;or</p>

<pre><code>knife ssh &#39;name:FQDN&#39; &#39;sudo chef-client&#39;</code></pre>

  <h3>Other Network and Compute Nodes</h3>

  <p>After the MySQL, RabbitMQ, and controller roles have been chefed, any of the remaining roles can then be run in any order for the other nodes, and can even be run in parallel to speed up your total deployment time. Compute and Network nodes can also be added any time after the initial deployment. Following the example above, the two commands would chef your network and compute nodes:</p>

<pre><code>## Compute node:
knife ssh &#39;name:FQDN_2&#39; &#39;sudo chef-client&#39;

## Network node:
knife ssh &#39;name:FQDN_3&#39; &#39;sudo chef-client&#39;</code></pre>